<!Doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Employee Onboarding — Single File (Responsive)</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jsPDF, html2canvas for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body{background:#f4f6fb;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',"Helvetica Neue",Arial}
    .page{display:none;padding:20px}
    .page.active{display:block}
    .logo{max-width:140px}
    .small-note{font-size:0.9rem;color:#555}
    /* responsive tweaks */
    @media(min-width:992px){
      .card-centered{max-width:900px;margin:30px auto}
        }
        /* signature canvas border */
    #sigCanvas {
      border:1px dashed #aaa;
      border-radius:6px;
      width:100%;
      height:200px;
    }
    </style>
    </head>
    <body>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="m-0">Air Flow Pvt. Ltd. Employee Onboarding</h4>
        <img src="https://airflow.in/wp-content/uploads/2021/12/cropped-AIR-1.png" 
             alt="Air Flow Logo" id="logo" style="max-width:150px;">
      </div>

        <!-- Page 1 : Login (Name, Mobile, Email + Send OTP via Apps Script) -->
        <div id="page1" class="page active">
          <h5>1 — Login / Email OTP</h5>
          <p class="small-note">Email par OTP Apps Script ke through bhejna hai. Apps Script web app URLs ko placeholders mein daalein (see JS comments).</p>
          <form id="form1" onsubmit="return false;">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input id="name" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Mobile Number</label>
              <input id="mobile" class="form-control" pattern="[0-9]{10}" maxlength="10" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input id="email" type="email" class="form-control" required>
            </div>
            <div class="d-flex gap-2">
              <button id="sendEmailOtpBtn" class="btn btn-primary">Send Email OTP</button>
              <button id="verifyEmailOtpBtn" class="btn btn-success" disabled>Verify OTP</button>
              <input id="emailOtpInput" class="form-control" placeholder="Enter OTP" style="max-width:200px">
            </div>
            <div id="form1msg" class="mt-2 small-note text-danger"></div>
          </form>
        </div>

        <!-- Page 2 : Aadhar & Mobile OTP -->
        <div id="page2" class="page">
          <h5>2 — Mobile & Aadhar</h5>
          <p class="small-note">Wo number bharein jo Aadhar se linked ho (format same as UIDAI, lekin OTP Apps Script se send kareinge).</p>
          <form id="form2" onsubmit="return false;">
            <div class="mb-3">
              <label class="form-label">Mobile Number (Aadhar se same)</label>
              <input id="aadharMobile" class="form-control" pattern="[0-9]{10}" maxlength="10" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Aadhar Number</label>
              <input id="aadhar" class="form-control" pattern="[0-9]{12}" maxlength="12" required>
            </div>
            <div class="d-flex gap-2">
              <button id="sendMobileOtpBtn" class="btn btn-primary">Send Mobile OTP</button>
              <button id="verifyMobileOtpBtn" class="btn btn-success" disabled>Verify Mobile OTP</button>
              <input id="mobileOtpInput" class="form-control" placeholder="Enter OTP" style="max-width:200px">
            </div>
            <div id="form2msg" class="mt-2 small-note text-danger"></div>
          </form>
        </div>

        <!-- Page 3 : Candidate Form (placeholder) -->
        <div id="page3" class="page">
          <h5>3 — Candidate Form</h5>
          <form id="candidateForm" onsubmit="return false;">
            <!-- Replace these fields with the exact format you will provide later -->
            <div class="mb-3">
              <label class="form-label">Father's / Guardian's Name</label>
              <input id="cand_guardian" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Date of Birth</label>
              <input id="cand_dob" type="date" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Address</label>
              <textarea id="cand_address" class="form-control" rows="3"></textarea>
            </div>
            <div class="d-flex justify-content-between">
              <button class="btn btn-secondary" onclick="prevPage(3)">Back</button>
              <button id="candNext" class="btn btn-primary">Save & Next</button>
            </div>
          </form>
        </div>

        <!-- Page 4 : Background Verification -->
        <div id="page4" class="page">
          <h5>4 — Background Verification</h5>
          <form id="bgForm" onsubmit="return false;">
            <!-- Placeholder fields -->
            <div class="mb-3">
              <label class="form-label">Previous Employer</label>
              <input id="prev_emp" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Reference Contact</label>
              <input id="ref_contact" class="form-control">
            </div>
            <div class="d-flex justify-content-between">
              <button class="btn btn-secondary" onclick="prevPage(4)">Back</button>
              <button id="bgNext" class="btn btn-primary">Save & Next</button>
            </div>
          </form>
        </div>

        <!-- Page 5 : Declaration -->
        <div id="page5" class="page">
          <h5>5 — Declaration</h5>
          <form id="decForm" onsubmit="return false;">
            <div class="mb-3">
              <label class="form-label">Declaration Text (agree)</label>
              <textarea id="dec_text" class="form-control">I hereby declare that all information provided is true.</textarea>
            </div>
            <div class="form-check mb-3">
              <input id="dec_check" type="checkbox" class="form-check-input" required>
              <label class="form-check-label">I agree</label>
            </div>
            <div class="d-flex justify-content-between">
              <button class="btn btn-secondary" onclick="prevPage(5)">Back</button>
              <button id="decNext" class="btn btn-primary">Save & Next</button>
            </div>
          </form>
        </div>

        <!-- Page 6 : Photo & Signature Upload -->
        <div id="page6" class="page">
          <h5>6 — Photo & Signature</h5>
          <p class="small-note">Photo & signature mein max 200 KB limit set ki gayi hai. Supported: jpg/png.</p>
          <form id="uploadForm" onsubmit="return false;">
            <div class="mb-3">
              <label class="form-label">Upload Photo</label>
              <input id="photoInput" type="file" accept="image/*" class="form-control" required>
              <img id="photoPreview" class="mt-2" style="max-width:180px;display:none;border-radius:6px" />
            </div>
            <div class="mb-3">
              <label class="form-label">Draw Signature (or upload)</label>
              <canvas id="sigCanvas"></canvas>
              <div class="mt-2 d-flex gap-2">
                <button id="clearSig" class="btn btn-sm btn-secondary">Clear</button>
                <button id="saveSig" class="btn btn-sm btn-primary">Save Signature</button>
                <input id="sigUpload" type="file" accept="image/*" class="form-control" style="max-width:240px">
              </div>
              <img id="sigPreview" class="mt-2" style="max-width:300px;display:none;border-radius:4px" />
            </div>
            <div class="d-flex justify-content-between">
              <button class="btn btn-secondary" onclick="prevPage(6)">Back</button>
              <button id="uploadNext" class="btn btn-primary">Upload & Next</button>
            </div>
            <div id="uploadMsg" class="mt-2 small-note text-danger"></div>
          </form>
        </div>

        <!-- Page 7 : Preview all data -->
        <div id="page7" class="page">
          <h5>7 — Preview</h5>
          <div id="previewArea" class="border rounded p-3 bg-white"></div>
          <div class="d-flex justify-content-between mt-3">
            <button class="btn btn-secondary" onclick="prevPage(7)">Back</button>
            <button id="toDownload" class="btn btn-success">Proceed to Download</button>
          </div>
        </div>

        <!-- Page 8 : Download & Send PDF -->
        <div id="page8" class="page">
          <h5>8 — Download & Email PDF</h5>
          <p class="small-note">Click Download to generate PDF immediately. PDF will also be sent to the user email (provided at login) and to the admin email you will provide in Apps Script.</p>
          <div class="d-flex gap-2">
            <button id="downloadPdf" class="btn btn-primary">Download PDF</button>
            <button id="sendPdfBtn" class="btn btn-outline-primary">Send PDF to Server & Email</button>
          </div>
          <div id="finalMsg" class="mt-2 small-note"></div>
        </div>

      </div>
    </div>
  </div>

  <!-- SCRIPT: Client-side logic -->
  <script>
    /* -----------------------------
       IMPORTANT: Replace these placeholders with your deployed Apps Script Web App URLs.
       Apps Script should expose endpoints (POST) for:
         1) /sendEmailOtp   -> {email, name}  -> sends email OTP to user
         2) /verifyEmailOtp -> {email, otp}   -> returns {ok:true} if matches
         3) /sendMobileOtp  -> {mobile}       -> sends mobile OTP (via email-to-sms or any service) OR simply email the mobile OTP to the user's email. For security, do server-side OTP generation and storage.
         4) /verifyMobileOtp-> {mobile, otp}  -> verify
         5) /receivePdf     -> {email, pdfBase64, filename} -> send pdf to user and admin email
       See the sample Apps Script code included at the bottom of this file (comment).
    -----------------------------*/

   // Base URL of your Apps Script
   const BASE_URL = 'https://script.google.com/macros/s/AKfycbwZqyAQYYANqZ22t456-bvtGlCJJ6NYLTsVUKaw0w/dev';
   // Endpoints
   const APPS_SEND_EMAIL_OTP = BASE_URL + '?action=send-otp';
   const APPS_VERIFY_EMAIL_OTP = BASE_URL + '?action=verify-otp';
    
   const APPS_SEND_MOBILE_OTP = 'REPLACE_WITH_YOUR_APPS_SCRIPT_SEND_MOBILE_OTP_URL';
   const APPS_VERIFY_MOBILE_OTP = 'REPLACE_WITH_YOUR_APPS_SCRIPT_VERIFY_MOBILE_OTP_URL';
   const APPS_RECEIVE_PDF = 'REPLACE_WITH_YOUR_APPS_SCRIPT_RECEIVE_PDF_URL';

    // Simple page router
    function showPage(n){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById('page'+n).classList.add('active');
      window.scrollTo({top:0,behavior:'smooth'});
    }
    function prevPage(curr){ showPage(curr-1); }
    function nextPage(curr){ showPage(curr+1); }

    // Page1: Email OTP
document.getElementById('sendEmailOtpBtn').addEventListener('click', async (e)=>{
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const mobile = document.getElementById('mobile').value.trim();
  const msgEl = document.getElementById('form1msg');
  msgEl.textContent='';
  if(!name||!email) { msgEl.textContent='Name and Email required'; return; }

  // send OTP using URL params (Apps Script expects e.parameter)
  try{
    const res = await fetch(`${APPS_SEND_EMAIL_OTP}&email=${encodeURIComponent(email)}`, {
      method:'POST'
    });
    const j = await res.json();
    if(j.ok){ 
      document.getElementById('verifyEmailOtpBtn').disabled=false; 
      msgEl.textContent='OTP sent to email.'; 
    } else msgEl.textContent = j.message || 'Failed to send OTP';
  }catch(err){ msgEl.textContent='Error sending OTP. Check Apps Script URL.' }
});

document.getElementById('verifyEmailOtpBtn').addEventListener('click', async ()=>{
  const email = document.getElementById('email').value.trim();
  const otp = document.getElementById('emailOtpInput').value.trim();
  const msgEl = document.getElementById('form1msg'); msgEl.textContent='';
  if(!otp){ msgEl.textContent='Enter OTP'; return; }

  // verify OTP using URL params
  try{
    const res = await fetch(`${APPS_VERIFY_EMAIL_OTP}&email=${encodeURIComponent(email)}&otp=${encodeURIComponent(otp)}`, {
      method:'POST'
    });
    const j = await res.json();
    if(j.ok){ 
      msgEl.classList.remove('text-danger'); 
      msgEl.classList.add('text-success'); 
      msgEl.textContent='Email verified!';
      // store login email in local state
      window.ONBOARDING = window.ONBOARDING || {};
      ONBOARDING.name = document.getElementById('name').value.trim();
      ONBOARDING.email = email; 
      ONBOARDING.mobile = document.getElementById('mobile').value.trim();
      setTimeout(()=>nextPage(2),700);
    } else { msgEl.textContent = j.message || 'Invalid OTP'; }
  }catch(err){ msgEl.textContent='Error verifying OTP'; }
});

// Page2: Aadhar & mobile otp
    document.getElementById('sendMobileOtpBtn').addEventListener('click', async (e)=>{
      e.preventDefault();
      const mobile = document.getElementById('aadharMobile').value.trim();
      const aadhar = document.getElementById('aadhar').value.trim();
      const msgEl = document.getElementById('form2msg'); msgEl.textContent='';
      if(!/^\d{12}$/.test(aadhar)){ msgEl.textContent='Aadhar must be 12 digits'; return; }
      if(!/^\d{10}$/.test(mobile)){ msgEl.textContent='Mobile must be 10 digits'; return; }
      try{
        const res = await fetch(APPS_SEND_MOBILE_OTP,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mobile,aadhar})});
        const j = await res.json();
        if(j.ok){ document.getElementById('verifyMobileOtpBtn').disabled=false; msgEl.textContent='OTP sent to mobile (via server).'; }
        else msgEl.textContent = j.error || 'Failed to send OTP';
      }catch(err){ msgEl.textContent='Error sending mobile OTP. Check Apps Script URL.' }
    });

    document.getElementById('verifyMobileOtpBtn').addEventListener('click', async ()=>{
      const mobile = document.getElementById('aadharMobile').value.trim();
      const otp = document.getElementById('mobileOtpInput').value.trim();
      const msgEl = document.getElementById('form2msg'); msgEl.textContent='';
      if(!otp){ msgEl.textContent='Enter OTP'; return; }
      try{
        const res = await fetch(APPS_VERIFY_MOBILE_OTP,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mobile,otp})});
        const j = await res.json();
        if(j.ok){ msgEl.classList.remove('text-danger'); msgEl.classList.add('text-success'); msgEl.textContent='Mobile & Aadhar verified!';
          window.ONBOARDING = window.ONBOARDING || {};
          ONBOARDING.aadhar = document.getElementById('aadhar').value.trim();
          ONBOARDING.aadharMobile = mobile;
          setTimeout(()=>nextPage(3),700);
        } else msgEl.textContent = j.error || 'Invalid OTP';
      }catch(err){ msgEl.textContent='Error verifying OTP'; }
    });

    // Candidate/other forms: Save into ONBOARDING state
    document.getElementById('candNext').addEventListener('click', ()=>{
      ONBOARDING = ONBOARDING||{};
      ONBOARDING.guardian = document.getElementById('cand_guardian').value;
      ONBOARDING.dob = document.getElementById('cand_dob').value;
      ONBOARDING.address = document.getElementById('cand_address').value;
      nextPage(4);
    });
    document.getElementById('bgNext').addEventListener('click', ()=>{
      ONBOARDING.prev_emp = document.getElementById('prev_emp').value;
      ONBOARDING.ref_contact = document.getElementById('ref_contact').value;
      nextPage(5);
    });
    document.getElementById('decNext').addEventListener('click', ()=>{
      ONBOARDING.dec_text = document.getElementById('dec_text').value;
      nextPage(6);
    });

    // Page6: Photo & signature handling
    const MAX_FILE_BYTES = 200*1024; // 200 KB
    const photoInput = document.getElementById('photoInput');
    const photoPreview = document.getElementById('photoPreview');
    photoInput.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      const msg = document.getElementById('uploadMsg'); msg.textContent='';
      if(!f) return;
      if(f.size>MAX_FILE_BYTES){ msg.textContent='Photo exceeds 200 KB'; photoInput.value=''; return; }
      const reader = new FileReader(); reader.onload = ()=>{ photoPreview.src = reader.result; photoPreview.style.display='block'; ONBOARDING.photoBase64 = reader.result; };
      reader.readAsDataURL(f);
    });

    // Signature canvas draw
    const sigCanvas = document.getElementById('sigCanvas');
    sigCanvas.width = sigCanvas.clientWidth; sigCanvas.height = 200; // explicit
    const sigCtx = sigCanvas.getContext('2d'); let drawing=false;
    function pointerDown(e){ drawing=true; sigCtx.beginPath(); sigCtx.moveTo(getX(e),getY(e)); }
    function pointerMove(e){ if(!drawing) return; sigCtx.lineTo(getX(e),getY(e)); sigCtx.stroke(); }
    function pointerUp(e){ drawing=false; }
    function getX(e){ const r=sigCanvas.getBoundingClientRect(); return (e.touches?e.touches[0].clientX:e.clientX)-r.left; }
    function getY(e){ const r=sigCanvas.getBoundingClientRect(); return (e.touches?e.touches[0].clientY:e.clientY)-r.top; }
    sigCanvas.addEventListener('pointerdown',pointerDown); sigCanvas.addEventListener('pointermove',pointerMove); sigCanvas.addEventListener('pointerup',pointerUp);
    document.getElementById('clearSig').addEventListener('click',()=>{ sigCtx.clearRect(0,0,sigCanvas.width,sigCanvas.height); document.getElementById('sigPreview').style.display='none'; delete ONBOARDING.sigBase64; });
    document.getElementById('saveSig').addEventListener('click',()=>{ const data = sigCanvas.toDataURL('image/png'); document.getElementById('sigPreview').src = data; document.getElementById('sigPreview').style.display='block'; ONBOARDING.sigBase64 = data; });

    // Upload signature via file
    document.getElementById('sigUpload').addEventListener('change',(e)=>{
      const f = e.target.files[0]; const msg = document.getElementById('uploadMsg'); msg.textContent='';
      if(!f) return; if(f.size>MAX_FILE_BYTES){ msg.textContent='Signature file exceeds 200 KB'; e.target.value=''; return; }
      const reader = new FileReader(); reader.onload = ()=>{ document.getElementById('sigPreview').src = reader.result; document.getElementById('sigPreview').style.display='block'; ONBOARDING.sigBase64 = reader.result; };
      reader.readAsDataURL(f);
    });

    document.getElementById('uploadNext').addEventListener('click', ()=>{
      const msg = document.getElementById('uploadMsg'); msg.textContent='';
      if(!ONBOARDING.photoBase64){ msg.textContent='Please upload photo'; return; }
      if(!ONBOARDING.sigBase64){ msg.textContent='Please provide signature'; return; }
      nextPage(7);
      renderPreview();
    });

    // Page7 preview
    function renderPreview(){
      const area = document.getElementById('previewArea');
      const o = ONBOARDING||{};
      area.innerHTML = `
        <h6>Personal</h6>
        <p><strong>Name:</strong> ${o.name||''}<br>
        <strong>Email:</strong> ${o.email||''}<br>
        <strong>Mobile:</strong> ${o.mobile||''}<br>
        <strong>Aadhar:</strong> ${o.aadhar||''}</p>
        <h6>Candidate</h6>
        <p><strong>Guardian:</strong> ${o.guardian||''}<br>
        <strong>DOB:</strong> ${o.dob||''}<br>
        <strong>Address:</strong> ${o.address||''}</p>
        <h6>Background</h6>
        <p><strong>Prev Employer:</strong> ${o.prev_emp||''}<br>
        <strong>Reference:</strong> ${o.ref_contact||''}</p>
        <h6>Declaration</h6>
        <p>${o.dec_text||''}</p>
        <div class="d-flex gap-3 align-items-center">
          <div>
            <p class="mb-1"><strong>Photo</strong></p>
            ${o.photoBase64?`<img src="${o.photoBase64}" style="max-width:140px;border-radius:6px">`:''}
          </div>
          <div>
            <p class="mb-1"><strong>Signature</strong></p>
            ${o.sigBase64?`<img src="${o.sigBase64}" style="max-width:260px;border-radius:4px">`:''}
          </div>
        </div>
      `;
    }

    document.getElementById('toDownload').addEventListener('click', ()=>{ nextPage(8); });

    // Page8: Generate PDF and download & send to server
    document.getElementById('downloadPdf').addEventListener('click', async ()=>{
      const area = document.getElementById('previewArea');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({unit:'px',format:'a4'});
      // Use html2canvas to capture
      const canvas = await html2canvas(area,{scale:2});
      const img = canvas.toDataURL('image/png');
      const imgProps = pdf.getImageProperties(img);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
      pdf.addImage(img,'PNG',0,0,pdfWidth,pdfHeight);
      pdf.save('onboarding.pdf');
    });

    document.getElementById('sendPdfBtn').addEventListener('click', async ()=>{
      const area = document.getElementById('previewArea');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({unit:'px',format:'a4'});
      const canvas = await html2canvas(area,{scale:2});
      const img = canvas.toDataURL('image/png');
      const imgProps = pdf.getImageProperties(img);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
      pdf.addImage(img,'PNG',0,0,pdfWidth,pdfHeight);
      const pdfBase64 = pdf.output('datauristring'); // data:application/pdf;base64,....

      // Send base64 pdf to Apps Script which will email it to user and admin
      try{
        const res = await fetch(APPS_RECEIVE_PDF,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:ONBOARDING.email,pdf:pdfBase64,filename:'onboarding.pdf'})});
        const j = await res.json();
        const el = document.getElementById('finalMsg');
        if(j.ok) el.textContent = 'PDF sent to your email and to admin.'; else el.textContent = j.error || 'Failed to send PDF';
      }catch(err){ document.getElementById('finalMsg').textContent='Error sending PDF. Check Apps Script URL.' }
    });

    // Initialize small local state
    window.ONBOARDING = window.ONBOARDING || {};
  </script>

  <!-- Sample Apps Script (server-side) - Paste into script.google.com and deploy as Web App (execute as: Me; access: Anyone with link)
       NOTE: This is a simple example. For production you should store OTPs securely (PropertiesService or Sheet) and clean them after expiry.

  // ---------- BEGIN SAMPLE APPS SCRIPT (server) ----------
  /**
   * Sample server-side endpoints (Apps Script) - NOT runnable in browser
   * Deploy as Web App (doPost) and route by 'action' param or separate doPost handlers.
   */
  /*
  // Code.gs
  function doPost(e){
    const data = JSON.parse(e.postData.contents);
    // route by path or properties
    if(e.parameter && e.parameter.action=='sendEmailOtp') return sendEmailOtp(data);
    if(e.parameter && e.parameter.action=='verifyEmailOtp') return verifyEmailOtp(data);
    if(e.parameter && e.parameter.action=='sendMobileOtp') return sendMobileOtp(data);
    if(e.parameter && e.parameter.action=='verifyMobileOtp') return verifyMobileOtp(data);
    if(e.parameter && e.parameter.action=='receivePdf') return receivePdf(data);
    return ContentService.createTextOutput(JSON.stringify({error:'no_action'})).setMimeType(ContentService.MimeType.JSON);
  }

  function randomOtp(){
    // 1 to 6 digit random OTP (could be 1-digit up to 6-digit)
    const length = Math.floor(Math.random()*6)+1; // 1..6
    let otp='';
    for(let i=0;i<length;i++) otp += Math.floor(Math.random()*10);
    return otp;
  }

  function sendEmailOtp(data){
    const email = data.email; const name = data.name || '';
    const otp = randomOtp();
    // store OTP in PropertiesService with key email
    const props = PropertiesService.getScriptProperties();
    props.setProperty('otp_email_'+email, otp);
    // send mail
    MailApp.sendEmail(email, 'Your OTP', 'Hello '+name+'\nYour OTP is: '+otp+'\n(It is valid for a short time)');
    return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON);
  }

  function verifyEmailOtp(data){
    const email = data.email; const otp = data.otp;
    const props = PropertiesService.getScriptProperties();
    const stored = props.getProperty('otp_email_'+email);
    if(stored && stored===otp){ props.deleteProperty('otp_email_'+email); return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON); }
    return ContentService.createTextOutput(JSON.stringify({ok:false,error:'invalid_otp'})).setMimeType(ContentService.MimeType.JSON);
  }

  function sendMobileOtp(data){
    const mobile = data.mobile; const aadhar = data.aadhar;
    const otp = randomOtp();
    const props = PropertiesService.getScriptProperties();
    props.setProperty('otp_mobile_'+mobile, otp);
    // If you have an SMS gateway, call it here. Otherwise as fallback, email OTP to the user's email (if available) or admin.
    // Example: MailApp.sendEmail(adminEmail, 'Mobile OTP for '+mobile, 'OTP: '+otp);
    return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON);
  }

  function verifyMobileOtp(data){
    const mobile = data.mobile; const otp = data.otp;
    const props = PropertiesService.getScriptProperties();
    const stored = props.getProperty('otp_mobile_'+mobile);
    if(stored && stored===otp){ props.deleteProperty('otp_mobile_'+mobile); return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON); }
    return ContentService.createTextOutput(JSON.stringify({ok:false,error:'invalid_otp'})).setMimeType(ContentService.MimeType.JSON);
  }

  function receivePdf(data){
    // data.pdf is dataURI like data:application/pdf;base64,....
    const pdfDataUri = data.pdf;
    const userEmail = data.email;
    const filename = data.filename || 'onboarding.pdf';
    // convert to blob
    const arr = pdfDataUri.split(',');
    const mime = arr[0].match(/:(.*?);/)[1];
    const b64 = arr[1];
    const blob = Utilities.newBlob(Utilities.base64Decode(b64), mime, filename);
    // send to user
    MailApp.sendEmail({to:userEmail,subject:'Your Onboarding PDF',body:'Please find attached',attachments:[blob]});
    // send to admin
    const admin = 'ADMIN_EMAIL_HERE';
    MailApp.sendEmail({to:admin,subject:'New Onboarding Submitted',body:'See attached',attachments:[blob]});
    return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON);
  }
  */
  // ---------- END SAMPLE APPS SCRIPT ----------
  -->

</body>
</html>
